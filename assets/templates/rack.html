{{define "head"}}<title>{{.Common.Title}}</title>{{end}}
{{define "javascript"}}
$(document).ready(function() {

   $("#rn_add").click(function() {
    var data = {
        VID: $("#VID_new").val(),
        FirstIP: $("#FirstIP_new").val(),
        LastIP: $("#LastIP_new").val(),
        RID: $("#RID").val(),
        action: "Add"
    };
    $.ajax({
      type: "POST",
      url: "{{.Common.Prefix}}/rack/network",
      data: data,
      error: function(jqXHR, textStatus, errorThrown) {
        alert("Error: " + jqXHR.responseText)
      },
      success: function(){ 
       document.location.reload(); 
      }
    });
  });

   $(".modify_rn").click(function() {
    var vid = this.id.split("_")[1];
    var action = this.value;
    var data = {
        //VID: vid, //$("#VID_" + id).val(),
        VID: $("#VID_" + vid).val(),
        FirstIP: $("#FirstIP_" + vid).val(),
        LastIP: $("#LastIP_" + vid).val(),
        RID: $("#RID").val(),
        OriginalVID: vid,
        action: action
    };
    $.ajax({
      type: "POST",
      url: "{{.Common.Prefix}}/rack/network",
      data: data,
      error: function(jqXHR, textStatus, errorThrown) {
        alert("Error: " + jqXHR.responseText)
      },
      success: function(){ 
       document.location.reload(); 
      }
    });
    /*
    */
  });

$(".rvlan").change(function () {
    var id = this.name.split("_")[1];
    $("#rn_" + id).val("Update");
  });

   $("#pdu_add").click(function() {
    var data = {
        RID: $("#RID").val(),
        IP: $("#IP_new").val(),
        Hostname: $("#Hostname_new").val(),
        action: "Add"
    };
    $.ajax({
      type: "POST",
      url: "{{.Common.Prefix}}/pdu/edit",
      data: data,
      error: function(jqXHR, textStatus, errorThrown) {
        alert("Error: " + jqXHR.responseText)
      },
      success: function(){ 
       document.location.reload(); 
      }
    });
  });

   $(".modify_pdu").click(function() {
    var id = this.id.split("_")[1];
    var data = {
        ID: id,
        action: "Delete"
    };
    $.ajax({
      type: "POST",
      url: "{{.Common.Prefix}}/pdu/edit",
      data: data,
      error: function(jqXHR, textStatus, errorThrown) {
        alert("Error: " + jqXHR.responseText)
      },
      success: function(){ 
       document.location.reload(); 
      }
    });
  });

});

{{end}}
{{define "body"}}
<div class="stacked">

<div id="rackform" class="rack">
<form method="post" class="common">
    <fieldset>
        <legend>General</legend>
        <div class="field">
            {{ if gt .Rack.ID 0 }}
            <label>Datacenter</label>
            <input type="text" name="DC" value="{{.DC}}" readonly/>
            {{ else }}
            <label>Datacenter</label>
            <select name="DID">{{range .Datacenters}}
                    <option value="{{.ID}}">{{.Name}}</option>
                    {{ end }}</select>
            {{ end }}
        </div>
        <div class="field">
            <label for="Label">Rack Number</label>
            <input type="text" name="Label" id="Label" value="{{.Rack.Label}}"/>
        </div>
        <div class="field">
            <label for="VendorID">Vendor ID</label>
            <input type="text" name="VendorID" id="VendorID" value="{{.Rack.VendorID}}"/>
        </div>
        <div class="field">
            <label for="RUs">Rack Height</label>
            <input type="text" name="RUs" id="RUs" value="{{.Rack.RUs}}"/>
        </div>
    </fieldset>
    {{/* for now
    <fieldset>
        <legend>Layout</legend>
        <div class="field">
            <label>X Pos</label>
            <input type="text" name="XPos" id="XPos" value="{{.Rack.XPos}}"/>
        </div>
        <div class="field">
            <label>Y Pos</label>
            <input type="text" name="YPos" id="YPos" value="{{.Rack.YPos}}"/>
        </div>
    </fieldset>
    */}}

<input type="hidden" name="ID" value="{{.Rack.ID}}">
<input type="hidden" name="DID" value="{{.Rack.DID}}">
<input type="hidden" name="UID" value="{{.User.ID}}">
<input type="button" value="Cancel"  onclick="javascript:window.history.go(-1)">
{{ if .Common.User.Editor }}
{{ if eq .Rack.ID 0 }}
<input type="submit" name="action" value="Add">
{{ else }}
<input type="submit" name="action" value="Update">
<input type="submit" name="action" value="Delete">
{{ end }}
{{ end }}
</form>
</div>

<div id="racknets" class="rack">
    <form method="post" class="common">
    <input type="hidden" name="ID" id="RID" value="{{.Rack.ID}}">
    <fieldset>
        <legend>VLANs</legend>
        <table>
        <tr>
            <th>VLAN</th><th>Start</th><th>End</th><th></th>
        </tr>
        {{ range .Rack.RackNets }}
        <tr>
            <td><input type="text" class="rvlan" id="VID_{{.VID}}" name="VID_{{.VID}}" value="{{.VID}}"/></td>
            <td><input type="text" class="rvlan" id="FirstIP_{{.VID}}" name="FirstIP_{{.VID}}" value="{{.FirstIP}}"/></td>
            <td><input type="text" class="rvlan" id="LastIP_{{.VID}}" name="LastIP_{{.VID}}" value="{{.LastIP}}"/></td>
            {{ if $.Common.User.Editor }}
            <td><input type="button" id="rn_{{.VID}}" class="modify_rn" value="Delete"></td>
            {{ end }}
        </tr>
        {{ end }}
        <tr>
            <td><input type="text" id="VID_new" name="VID_new" value=""/></td>
            <td><input type="text" id="FirstIP_new" name="FirstIP_new" value=""/></td>
            <td><input type="text" id="LastIP_new" name="LastIP_new" value=""/></td>
            {{ if $.Common.User.Editor }}
            <td><input type="button" id="rn_add" value="Add"></td>
            {{ end }}
        </tr>
        </table>
    </fieldset>
    </form>

</div>

<div id="rack_pdus" class="rack">
    <form class="common">
    <fieldset>
        <legend>PDUs</legend>
        <table>
        {{ range .Rack.PDUs }}
        <tr>
            <td><input type="text" class="pdu" id="Hostname_{{.ID}}" name="Hostname_{{.ID}}" value="{{.Hostname}}"/></td>
            <td><input type="text" class="pdu" id="IP_{{.ID}}" name="IP_{{.ID}}" value="{{.IP}}"/></td>
            {{ if $.Common.User.Editor }}
            <td><input type="button" id="pdu_{{.ID}}" class="modify_pdu" value="Delete"></td>
            {{ end }}
        </tr>
        {{ end }}
        <tr>
            <td><input type="text" id="Hostname_new" name="Hostname_new" value=""/></td>
            <td><input type="text" id="IP_new" name="IP_new" value=""/></td>
            {{ if $.Common.User.Editor }}
            <td><input type="button" id="pdu_add" value="Add"></td>
            {{ end }}
        </tr>
        </table>
    </fieldset>
    </form>
</div>

</div>
{{end}}

